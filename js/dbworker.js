

    const worker = 'var JsStoreWorker=function(i){var l={};function n(d){if(l[d])return l[d].exports;var m=l[d]={i:d,l:!1,exports:{}};return i[d].call(m.exports,m,m.exports,n),m.l=!0,m.exports}return n.m=i,n.c=l,n.d=function(i,l,d){n.o(i,l)||Object.defineProperty(i,l,{enumerable:!0,get:d})},n.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n.t=function(i,l){if(1&l&&(i=n(i)),8&l)return i;if(4&l&&"object"==typeof i&&i&&i.__esModule)return i;var d=Object.create(null);if(n.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:i}),2&l&&"string"!=typeof i)for(var m in i)n.d(d,m,function(l){return i[l]}.bind(null,m));return d},n.n=function(i){var l=i&&i.__esModule?function(){return i.default}:function(){return i};return n.d(l,"a",l),l},n.o=function(i,l){return Object.prototype.hasOwnProperty.call(i,l)},n.p="",n(n.s=3)}({3:function(i,l,d){"use strict";var m,w,k,q,S,C,O,I,j;d.r(l),d.d(l,"QueryManager",(function(){return Et})),function(i){i.UndefinedColumn="undefined_column",i.UndefinedValue="undefined_value",i.UndefinedColumnName="undefined_column_name",i.UndefinedDbName="undefined_database_name",i.UndefinedColumnValue="undefined_column_value",i.NotArray="not_array",i.NoValueSupplied="no_value_supplied",i.ColumnNotExist="column_not_exist",i.EnableSearchOff="enable_search_off",i.InvalidOp="invalid_operator",i.NullValue="null_value",i.WrongDataType="wrong_data_type",i.TableNotExist="table_not_exist",i.DbNotExist="db_not_exist",i.ConnectionAborted="connection_aborted",i.ConnectionClosed="connection_closed",i.NotObject="not_object",i.InvalidConfig="invalid_config",i.DbBlocked="Db_blocked",i.IndexedDbNotSupported="indexeddb_not_supported",i.NullValueInWhere="null_value_in_where",i.InvalidJoinQuery="invalid_join_query",i.InvalidOrderQuery="invalid_order_query",i.InvalidQuery="invalid_query",i.InvalidGroupQuery="invalid_group_query",i.ImportScriptsFailed="import_scripts_failed",i.MethodNotExist="method_not_exist",i.Unknown="unknown"}(m||(m={})),function(i){i.Registered="registerd",i.Failed="failed",i.NotStarted="not_started"}(w||(w={})),function(i){i.String="string",i.Object="object",i.Array="array",i.Number="number",i.Boolean="boolean",i.Null="null",i.DateTime="date_time"}(k||(k={})),function(i){i.InitDb="init_db",i.Get="get",i.Set="set",i.Select="select",i.Insert="insert",i.Update="update",i.Remove="remove",i.OpenDb="open_db",i.Clear="clear",i.DropDb="drop_db",i.Count="count",i.ChangeLogStatus="change_log_status",i.Terminate="terminate",i.Transaction="transaction",i.CloseDb="close_db",i.Union="union",i.Intersect="intersect",i.ImportScripts="import_scripts"}(q||(q={})),function(i){i.RequestQueueEmpty="requestQueueEmpty",i.RequestQueueFilled="requestQueueFilled"}(S||(S={})),function(i){i.Where="where",i.Like="like",i.Regex="regex",i.In="in",i.Equal="=",i.Between="-",i.GreaterThan=">",i.LessThan="<",i.GreaterThanEqualTo=">=",i.LessThanEqualTo="<=",i.NotEqualTo="!=",i.Aggregate="aggregate",i.Max="max",i.Min="min",i.Avg="avg",i.Count="count",i.Sum="sum",i.Or="or",i.Skip="skip",i.Limit="limit",i.And="and",i.IgnoreCase="ignoreCase",i.Then="then"}(C||(C={})),function(i){i.ReadOnly="readonly",i.ReadWrite="readwrite"}(O||(O={})),function(i){i.First="f",i.Last="l",i.Any="a"}(I||(I={})),function(i){i.Connected="connected",i.Closed="closed",i.NotStarted="not_started",i.UnableToStart="unable_to_start",i.ClosedByJsStore="closed_by_jsstore"}(j||(j={}));var A,p=function(i){return new Promise(i)};!function(i){i.Create="create",i.Delete="delete"}(A||(A={}));var B,we=function(){function e(i,l){this.autoIncColumnValue={};var d=[];for(var m in i.columns){var w=i.columns[m];w.name=m,w.autoIncrement&&(this.autoIncColumnValue[m]=0),w.primaryKey&&(this.primaryKey=m),w.enableSearch=null==w.enableSearch||w.enableSearch,d.push(w)}this.columns=d,this.name=i.name,this.version=i.version||1,l>this.version&&(this.version=l),this.setState_()}return e.prototype.setState_=function(){this.state=A.Create},e}(),xe=function(){function e(){}return e.autoIncrementKey=function(i,l){return"JsStore_"+i+"_"+l+"_Value"},e.set=function(i,l,d){d.tx||d.createTransaction([e.tableName]);var m=d.objectStore(e.tableName);return p((function(d,w){var k=m.put({key:i,value:l});k.onsuccess=function(){d()},k.onerror=w}))},e.get=function(i,l){l.tx||l.createTransaction([e.tableName]);var d=l.objectStore(e.tableName);return p((function(m,w){var k=d.get(l.keyRange(i));k.onsuccess=function(){var i=k.result;m(i&&i.value)},k.onerror=w}))},e.remove=function(i,l){l.tx||l.createTransaction([e.tableName]);var d=l.objectStore(e.tableName);return p((function(m,w){var k=d.delete(l.keyRange(i));k.onsuccess=m,k.onerror=w}))},e.tableName="JsStore_Meta",e.dbSchema="JsStore_DbSchema",e}(),b=function(i){this.name=i.name,i.tables.push({name:xe.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=i.tables.map((function(l){return new we(l,i.version)})),this.version=i.version||1},ke=function(){function e(i){this.db=i}return e.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},e.prototype.createTransaction=function(i,l){var d=this;return void 0===l&&(l=O.ReadWrite),this.tx=this.con.transaction(i,l),p((function(i,l){d.tx.oncomplete=i,d.tx.onabort=i,d.tx.onerror=l}))},e.prototype.keyRange=function(i,l){var d;switch(l){case C.Between:d=IDBKeyRange.bound(i.low,i.high,!1,!1);break;case C.GreaterThan:d=IDBKeyRange.lowerBound(i,!0);break;case C.GreaterThanEqualTo:d=IDBKeyRange.lowerBound(i);break;case C.LessThan:d=IDBKeyRange.upperBound(i,!0);break;case C.LessThanEqualTo:d=IDBKeyRange.upperBound(i);break;default:d=IDBKeyRange.only(i)}return d},e.prototype.objectStore=function(i){return this.tx.objectStore(i)},e.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},e.prototype.close=function(){var i=this;return this.con&&this.con.close(),p((function(l){i.con=null,setTimeout(l,100)}))},e.prototype.initDb=function(){var i=this,l=this.db,d=!1;return p((function(m,w){var k=indexedDB.open(l.name,l.version);k.onsuccess=function(){i.con=k.result,i.con.onversionchange=function(i){i.target.close()},m(d)},k.onerror=function(i){console.error("error",i),w(i)},k.onupgradeneeded=function(i){var m=i.target.result;d=!0;var w=[A.Create,A.Delete];l.tables.forEach((function(i){w.indexOf(i.state)>=0&&function(i){var l=i.primaryKey?{keyPath:i.primaryKey}:{autoIncrement:!0};m.objectStoreNames.contains(i.name)&&m.deleteObjectStore(i.name);var d=m.createObjectStore(i.name,l);i.columns.forEach((function(i){if(i.enableSearch){var l=i.name,m=i.primaryKey?{unique:!0}:{unique:i.unique};m.multiEntry=i.multiEntry;var w=null==i.keyPath?l:i.keyPath;d.createIndex(l,w,m)}}))}(i)}))}}))},e}(),g=function(i){return Promise.all(i)},_=function(i){return Promise.reject(i)},Qe=function(){function e(i,l){void 0===l&&(l=null),this.type=i,this.info_=l,this.message=this.getMsg_()}return e.prototype.throw=function(){throw this.get()},e.prototype.log=function(i){console.log(i)},e.prototype.logError=function(){console.error(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg_=function(){var i;switch(this.type){case m.NotArray:i="Supplied value is not an array";break;case m.UndefinedColumn:i="Column is undefined in Where";break;case m.UndefinedValue:i="Value is undefined in Where";break;case m.UndefinedColumnName:i="Column name is undefined \'"+this.info_.TableName+"\'";break;case m.UndefinedDbName:i="Database name is not supplied";break;case m.UndefinedColumnValue:i="Column value is undefined";break;case m.NoValueSupplied:i="No value is supplied";break;case m.InvalidOp:i="Invalid Op Value \'"+this.info_.Op+"\'";break;case m.ColumnNotExist:i=this.info_.isOrder?"Column \'"+this.info_.column+"\' in order query does not exist":"Column \'"+this.info_.column+"\' does not exist";break;case m.EnableSearchOff:i="Search is turned off for the Column \'"+this.info_.column+"\'";break;case m.NullValue:i="Null value is not allowed for column \'"+this.info_.ColumnName+"\'";break;case m.WrongDataType:i="Supplied value for column \'"+this.info_.column+"\' have wrong data type";break;case m.TableNotExist:i="Table \'"+this.info_.tableName+"\' does not exist";break;case m.DbNotExist:i="Database with name "+this.info_.dbName+" does not exist";break;case m.NotObject:i="supplied value is not object";break;case m.InvalidOp:i="Invalid Config \'"+this.info_.Config+" \'";break;case m.DbBlocked:i="database is blocked, cant be deleted right now";break;case m.NullValueInWhere:i="Null/undefined is not allowed in where. Column \'"+this.info_.column+"\' has null";break;case m.MethodNotExist:i="method "+this.info_+" does not exist.";break;case m.IndexedDbNotSupported:i="Browser does not support indexeddb";break;case m.InvalidJoinQuery:case m.InvalidGroupQuery:case m.InvalidOrderQuery:case m.ImportScriptsFailed:i=this.info_;break;default:this.type||(this.type=m.Unknown),i=this.message}return i},e}(),x=function(i){if(i instanceof Qe)return i.logError(),i.get();var l=void 0;return i.name?(l=new Qe(i.name)).message=i.message:(l=new Qe(i.target.error.name)).message=i.target.error.message,l.logError(),l.get()},De=function(){function e(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return e.prototype.table=function(i){var l=i||this.tableName;return this.db.tables.find((function(i){return i.name===l}))},e.prototype.primaryKey=function(i){return this.table(i).primaryKey},e.prototype.getColumnInfo=function(i,l){return this.table(l).columns.find((function(l){return l.name===i}))},e.prototype.onException=function(i,l){return console.error(i),this.util.abortTransaction(),_(function(i,l){return void 0===l&&(l=m.InvalidQuery),i.name=l,x(i)}(i,l))},e}(),E=function(i){if(null==i)return k.Null;var l=typeof i;if("object"===l){if(Array.isArray(i))return k.Array;if(i instanceof Date)return k.DateTime}return l},T=function(i){if(null==i)return!0;switch(typeof i){case"string":return 0===i.length;case"number":return isNaN(i)}return!1},We=function(){function e(i,l){this.table=i,this.autoIncrementValue=l}return e.prototype.checkAndModifyValues=function(i){var l,d=this;return i.every((function(i){return!(l=d.checkAndModifyValue(i))})),{err:l,values:i}},e.prototype.checkAndModifyValue=function(i){var l,d=this;return this.table.columns.every((function(m){return!(l=d.checkAndModifyColumnValue_(m,i))})),l},e.prototype.checkNotNullAndDataType_=function(i,l){return i.notNull&&T(l[i.name])?this.getError(m.NullValue,{ColumnName:i.name}):i.dataType&&!T(l[i.name])&&E(l[i.name])!==i.dataType?this.getError(m.WrongDataType,{column:i.name}):void 0},e.prototype.checkAndModifyColumnValue_=function(i,l){var d=l[i.name];return i.autoIncrement?T(d)?l[i.name]=++this.autoIncrementValue[i.name]:E(d)===k.Number&&d>this.autoIncrementValue[i.name]&&(this.autoIncrementValue[i.name]=d):void 0!==i.default&&T(d)&&(l[i.name]=i.default),this.checkNotNullAndDataType_(i,l)},e.prototype.getError=function(i,l){return new Qe(i,l)},e}(),Fe=function(){function e(i){this.table=i}return e.prototype.check=function(i,l){var d,w=this;return typeof i===k.Object?this.table?this.table.columns.every((function(l){return l.name in i&&(d=w.checkByColumn_(l,i[l.name])),!d})):d=new Qe(m.TableNotExist,{tableName:l}):d=new Qe(m.NotObject),d},e.prototype.checkByColumn_=function(i,l){if(!0===i.notNull&&T(l))return new Qe(m.NullValue,{ColumnName:i.name});var d=E(l),w=null!=l;if(i.dataType&&w&&d!==i.dataType&&"object"!==d)return new Qe(m.WrongDataType,{column:i.name});if(w&&"object"===d){var k=["+","-","*","/","{push}"];for(var q in l)if(k.indexOf(q)<0&&i.dataType&&d!==i.dataType)return new Qe(m.WrongDataType,{column:i.name})}},e}(),Ke=function(){function e(i){this.db=i}return e.prototype.validate=function(i,l){switch(i){case q.Select:case q.Remove:case q.Count:return this.checkSelect(l);case q.Insert:return this.checkInsertQuery(l);case q.Update:return this.checkUpdate(l)}},e.prototype.getTable_=function(i){return this.db.tables.find((function(l){return l.name===i}))},e.prototype.isInsertQryValid_=function(i){var l,d=this.getTable_(i.into);if(d)switch(E(i.values)){case k.Array:break;case k.Null:l=new Qe(m.NoValueSupplied);break;default:l=new Qe(m.NotArray)}else l=new Qe(m.TableNotExist,{tableName:i.into});return{table:d,log:l}},e.prototype.checkUpdate=function(i){var l=new Fe(this.getTable_(i.in)).check(i.set,i.in);if(l)return l;if(null!=i.where){if(l=this.checkForNullInWhere_(i))return l;this.addGreatAndLessToNotOp_(i)}},e.prototype.checkSelect=function(i){if(!this.getTable_(i.from))return new Qe(m.TableNotExist,{tableName:i.from});if(i.where){var l=this.checkForNullInWhere_(i);if(l)return l;this.addGreatAndLessToNotOp_(i)}},e.prototype.checkForNullInWhere_=function(i){for(var l in i.where)if(null==i.where[l])return new Qe(m.NullValueInWhere,{column:l})},e.prototype.addGreatAndLessToNotOp_=function(i){var l=i.where,n=function(i,l){return l.findIndex((function(l){return null!=i[l][C.NotEqualTo]}))>=0},r=function(i,l){var d;return l.forEach((function(l){null!=(d=i[l])[C.NotEqualTo]&&(i[l][C.GreaterThan]=d[C.NotEqualTo],void 0===i[C.Or]?(i[C.Or]={},i[C.Or][l]={}):void 0===i[C.Or][l]&&(i[C.Or][l]={}),i[C.Or][l][C.LessThan]=d[C.NotEqualTo],delete i[l][C.NotEqualTo])})),i};if(E(l)===k.Object){var d=Object.keys(l);if(n(l,d))if(1===d.length)i.where=r(l,d);else{var m=[];d.forEach((function(i){var d;m.push(r(((d={})[i]=l[i],d),[i]))})),i.where=m}}else{var w=[];l.forEach((function(i){var l=Object.keys(i);n(i,l)&&(i=r(i,l)),w.push(i)})),i.where=w}},e.prototype.checkInsertQuery=function(i){var l=this.isInsertQryValid_(i),d=l.table,m=l.log;if(m)return m;if(!i.skipDataCheck){var w=new We(d,d.autoIncColumnValue).checkAndModifyValues(i.values),k=w.values,q=w.err;return i.values=k,q}},e}(),Xe=(B=function(i,l){return B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},B(i,l)},function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function n(){this.constructor=i}B(i,l),i.prototype=null===l?Object.create(l):(n.prototype=l.prototype,new n)}),Ye=function(i){function t(l,d){var m=i.call(this)||this;return m.valuesAffected_=[],m.query=l,m.util=d,m.tableName=l.into,m}return Xe(t,i),t.prototype.execute=function(i){var l=this,d=new Ke(i).validate(q.Insert,this.query);return d?_(d):this.insertData_(i).then((function(){return l.query.return?l.valuesAffected_:l.rowAffected})).catch((function(i){return l.util.abortTransaction(),_(i)}))},t.prototype.insertData_=function(i){var l,d,m,w=this;return d=this.query.return?function(i){w.valuesAffected_.push(i)}:function(){++w.rowAffected},m=this.query.upsert?function(i){return l.put(i)}:function(i){return l.add(i)},this.isTxQuery||this.util.createTransaction([this.query.into,xe.tableName]),l=this.util.objectStore(this.tableName),g(this.query.values.map((function(i){return p((function(l,w){var k=m(i);k.onerror=w,k.onsuccess=function(){d(i),l()}}))}))).then((function(){xe.set(xe.dbSchema,i,w.util)}))},t}(De),Ze=void 0===self.alert&&"undefined"==typeof ServiceWorkerGlobalScope,tt=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch(i){return!1}return!0}(),N=function(i){return Object.keys(i)},R=function(i){return Array.isArray(i)},Q=function(i){return N(i).length},D=function(i){for(var l in i)return l},L=function(){var i=this;this.query.case?this.pushResult=function(l){for(var d in i.thenEvaluator.setCaseAndValue(i.query.case,l),i.query.case)l[d]=i.thenEvaluator.setColumn(d).evaluate();i.results.push(l)}:this.pushResult=function(l){i.results.push(l)}},V=function(){this.query.limit&&(this.shouldEvaluateLimitAtEnd=!0),this.query.skip&&(this.shouldEvaluateSkipAtEnd=!0)},W=function(){var i=this.results;this.results=null;for(var l=this.primaryKey(),d={},m=0,w=i.length;m<w;m++)d[i[m][l]]=i[m];for(var m in i=[],d)i.push(d[m]);this.results=i},rt=function(){function e(){}return e.prototype.setCaseAndValue=function(i,l){this.caseQuery_=i,this.setValue(l)},e.prototype.setCaseAndColumn=function(i,l){return this.caseQuery_=i,this.setColumn(l),this},e.prototype.setColumn=function(i){return this.columnName_=i,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},e.prototype.setValue=function(i){return this.value=i,this},e.prototype.evaluate=function(){for(var i=0;i<this.length_;i++)if(!0===this.checkCase_(this.caseColumnQuery_[i]))return this.caseColumnQuery_[i].then;var l=this.caseColumnQuery_[this.length_-1].then;return null==l?this.value[this.columnName_]:l},e.prototype.checkCase_=function(i){for(var l in i){switch(l){case C.GreaterThan:if(this.value[this.columnName_]>i[l])return!0;break;case C.Equal:if(this.value[this.columnName_]===i[l])return!0;break;case C.LessThan:if(this.value[this.columnName_]<i[l])return!0;break;case C.GreaterThanEqualTo:if(this.value[this.columnName_]>=i[l])return!0;break;case C.LessThanEqualTo:if(this.value[this.columnName_]<=i[l])return!0;break;case C.NotEqualTo:if(this.value[this.columnName_]!==i[l])return!0;break;case C.Between:if(this.value[this.columnName_]>i[l].low&&this.value[this.columnName_]<i[l].high)return!0}return!1}},e}(),P=function(){var i,l=this;if(this.query.order&&!1!==this.query.order.idbSorting&&this.query.order.by){if(!this.objectStore.indexNames.contains(this.query.order.by))return _(new Qe(m.ColumnNotExist,{column:this.query.order.by,isOrder:!0}));var d=this.query.order.type&&"desc"===this.query.order.type.toLowerCase()?"prev":"next";this.sorted=!0,i=this.objectStore.index(this.query.order.by).openCursor(null,d)}else i=this.objectStore.openCursor();var w=function(){if(!1===l.shouldEvaluateLimitAtEnd&&!1===l.shouldEvaluateSkipAtEnd){if(l.skipRecord&&l.limitRecord)return U;if(l.skipRecord)return G;if(l.limitRecord)return K}return F}();return p((function(d,m){i.onerror=m,i.onsuccess=w.call(l,d)}))},U=function(i){var l,d=this,m=!1;return function(w){(l=w.target.result)?m&&d.results.length!==d.limitRecord?(d.pushResult(l.value),l.continue()):(m=!0,l.advance(d.skipRecord)):i()}},G=function(i){var l,d=this,m=!1;return function(w){(l=w.target.result)?m?(d.pushResult(l.value),l.continue()):(m=!0,l.advance(d.skipRecord)):i()}},F=function(i){var l,d=this;return function(m){(l=m.target.result)?(d.pushResult(l.value),l.continue()):i()}},K=function(i){var l,d=this;return function(m){(l=m.target.result)&&d.results.length!==d.limitRecord?(d.pushResult(l.value),l.continue()):i()}},J=function(i){return i.replace(/\\s/g,"")},M=function(){if(this.query.distinct){var i=[],l=this.results[0];for(var d in l)i.push(d);var m=this.primaryKey(),w=i.indexOf(m);i.splice(w,1),this.query.groupBy=i.length>0?i:null}this.query.groupBy?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry()},z=function(i){var l;if(null==this.query.join)l=this.getColumnInfo(i);else{var d=J(i).split(".");i=d[1],l=this.getColumnInfo(i,d[0])}if(null==l){var w=this.results[0][i];if(w)return{dataType:E(w),name:i};throw new Qe(m.ColumnNotExist,{column:i,isOrder:!0})}return l},$=function(i,l){return l.localeCompare(i)},H=function(i,l){return i.localeCompare(l)},X=function(i,l){return new String(l).localeCompare(i)},Y=function(i,l){return new String(i).localeCompare(l)},Z=function(i,l){return l-i},ee=function(i,l){return i-l},te=function(i,l){return l.getTime()-i.getTime()},ne=function(i,l){return i.getTime()-l.getTime()},re=function(i,l,d){for(var m in d){this.thenEvaluator.setCaseAndValue(d,i);var w=this.thenEvaluator.setColumn(m).evaluate();this.thenEvaluator.setCaseAndValue(d,l);var q=this.thenEvaluator.setColumn(m).evaluate();return typeof i[w]===k.String?$(i[w],l[q]):Z(i[w],l[q])}},oe=function(i,l,d){for(var m in d){this.thenEvaluator.setCaseAndValue(d,i);var w=this.thenEvaluator.setColumn(m).evaluate();this.thenEvaluator.setCaseAndValue(d,l);var q=this.thenEvaluator.setColumn(m).evaluate();return typeof i[w]===k.String?H(i[w],l[q]):ee(i[w],l[q])}},ie=function(i,l){switch(i.dataType){case k.String:return"asc"===l.type?H:$;case k.Number:return"asc"===l.type?ee:Z;case k.DateTime:return"asc"===l.type?ne:te;default:return"asc"===l.type?Y:X}},ue=function(i){var l,d=this;i.type=se(i.type);var m=i.by;if(null!=m&&typeof m===k.Object)"asc"===i.type?this.results.sort((function(i,l){return oe.call(d,i,l,m)})):this.results.sort((function(i,l){return re.call(d,i,l,m)}));else{var w=z.call(this,m);if(null!=w){var q=ie(w,i);m=w.name,null==i.case?this.results.sort((function(i,l){return q(i[m],l[m])})):(this.thenEvaluator.setCaseAndColumn(((l={})[m]=i.case,l),m),this.results.sort((function(i,l){return q(d.thenEvaluator.setValue(i).evaluate(),d.thenEvaluator.setValue(l).evaluate())})))}}},se=function(i){return null==i?"asc":i.toLowerCase()},ae=function(){var i=this.query.order;if(i&&this.results.length>0&&!this.sorted){var l=E(i);if(l===k.Object)ue.call(this,i);else if(l===k.Array){ue.call(this,i[0]);for(var n=function(l){var m=i[l-1].by,w=i[l],k=w.by,q=z.call(d,k);if(null!=q){k=q.name,w.type=se(w.type);var S=ie(q,w);d.results.sort((function(i,l){return i[m]===l[m]?S(i[k],l[k]):0}))}},d=this,m=1,w=i.length;m<w;m++)n(m)}}},ce=function(){var i,l=this.results,d=l.length,m={};this.results=void 0;var o=function(){var d=0;for(var m in l)d+=l[m][i]?1:0;return d},u=function(){var d=0;for(var m in l)d=d>l[m][i]?d:l[m][i];return d},s=function(){var d=1/0,m=1/0;for(var w in l)d=d<(m=l[w][i]?l[w][i]:1/0)?d:m;return d},a=function(){var d=0;for(var m in l)d+=l[m][i];return d},c=function(){var m=0;for(var w in l)m+=l[w][i];return m/d};for(var w in this.query.aggregate){var q=this.query.aggregate[w],S=E(q),C=void 0;switch(w){case"count":C=o;break;case"max":C=u;break;case"min":C=s;break;case"sum":C=a;break;case"avg":C=c}switch(S){case k.String:m[w+"("+(i=q)+")"]=C();break;case k.Array:for(var O in q)m[w+"("+(i=q[O])+")"]=C()}}for(var w in m)l[0][w]=m[w];this.results=[l[0]]},le=function(){var i=this.query.groupBy,l=this.results,d={};if(this.results=this.query.groupBy=null,E(i)!==k.Object)if(E(i)===k.String)for(var m in l)d[l[m][i]]=l[m];else{var w=void 0;for(var m in l){for(var q in w="",i)w+=l[m][i[q]];d[w]=l[m]}}else if(1===Object.keys(i).length){var S=D(i);for(var m in this.thenEvaluator.setCaseAndColumn(i,S),l)d[this.thenEvaluator.setValue(l[m]).evaluate()]=l[m]}else for(var m in w=void 0,l){for(var q in w="",this.thenEvaluator.setCaseAndValue(i,l[m]),i)w+=this.thenEvaluator.setColumn(q).evaluate();d[w]=l[m]}for(var m in l=[],d)l.push(d[m]);this.results=l},he=function(){var i=this.query.groupBy,l=this.results;this.results=void 0;var d,m,w,q={},S=this.query.aggregate,c=function(){var e=function(){return m=(m=q[d])?m["count("+w+")"]:0,m+=l[O][w]?1:0},c=function(){return m=(m=q[d])?m["max("+w+")"]:0,l[O][w]=l[O][w]?l[O][w]:0,m>l[O][w]?m:l[O][w]},h=function(){return m=(m=q[d])?m["min("+w+")"]:1/0,l[O][w]=l[O][w]?l[O][w]:1/0,m<l[O][w]?m:l[O][w]},f=function(){return m=(m=q[d])?m["sum("+w+")"]:0,m+=l[O][w]?l[O][w]:0},p=function(){var i=(m=q[d])?m["sum("+w+")"]:0;i+=l[O][w]?l[O][w]:0,l[O]["sum("+w+")"]=i,m=m?m["count("+w+")"]:0,m+=l[O][w]?1:0,l[O]["count("+w+")"]=m};for(var i in S){var I=S[i],j=E(I),A=void 0;switch(i){case C.Count:A=e;break;case C.Max:A=c;break;case C.Min:A=h;break;case C.Sum:A=f;break;case C.Avg:A=p}switch(j){case k.String:w=I,l[O][i+"("+w+")"]=A();break;case k.Array:for(var B in I)w=I[B],l[O][i+"("+w+")"]=A()}}};if(E(i)===k.String)for(var O in l)d=l[O][i],c(),q[d]=l[O];else for(O in l){for(var I in d="",i)d+=l[O][i[I]];c(),q[d]=l[O]}for(var j in l=[],q)l.push(q[j]);if(S.avg)if(E(S.avg)===k.String)for(O in l){var A=l[O]["sum("+S.avg+")"],B=l[O]["count("+S.avg+")"];l[O]["avg("+S.avg+")"]=A/B,S.count!==S.avg&&delete l[O]["count("+S.avg+")"],S.sum!==S.avg&&delete l[O]["sum("+S.avg+")"]}else{var we=E(S.count)===k.String,xe=E(S.sum)===k.String;for(O in l)for(var I in S.avg){var ke=S.avg[I],Qe=l[O]["sum("+ke+")"],De=l[O]["count("+ke+")"];l[O]["avg("+ke+")"]=Qe/De,we&&(S.count!==ke||-1===S.count.indexOf(ke))&&delete l[O]["count("+ke+")"],xe&&(S.sum!==ke||-1===S.sum.indexOf(ke))&&delete l[O]["sum("+ke+")"]}}this.results=l},fe=function(i,l,d,m){var w=this;l=d?l[d]:l;var k=this.objectStore.index(i).openCursor(this.util.keyRange(l,d),m),q=function(){if(!1===w.shouldEvaluateLimitAtEnd&&!1===w.shouldEvaluateSkipAtEnd){if(w.skipRecord&&w.limitRecord)return pe;if(w.skipRecord)return de;if(w.limitRecord)return ye}return ve}();return p((function(i,l){k.onerror=l,k.onsuccess=q.call(w,i)}))},pe=function(i){var l=this,d=!1;return function(m){var w=m.target.result;if(w)if(d&&l.results.length!==l.limitRecord){var k=w.value;l.shouldAddValue(k)&&l.pushResult(k),w.continue()}else d=!0,w.advance(l.skipRecord);else i()}},de=function(i){var l=this,d=!1;return function(m){var w=m.target.result;if(w)if(d){var k=w.value;l.shouldAddValue(k)&&l.pushResult(k),w.continue()}else d=!0,w.advance(l.skipRecord);else i()}},ye=function(i){var l=this;return function(d){var m=d.target.result;if(m&&l.results.length!==l.limitRecord){var w=m.value;l.shouldAddValue(w)&&l.pushResult(w),m.continue()}else i()}},ve=function(i){var l=this;return function(d){var m=d.target.result;if(m){var w=m.value;l.shouldAddValue(w)&&l.pushResult(w),m.continue()}else i()}},be=function(i){var l,d,m=i.split("%");switch(m[1]?(l=m[1],d=m.length>2?I.Any:I.Last):(l=m[0],d=I.First),d){case I.First:return new RegExp("^"+l,"i");case I.Last:return new RegExp(l+"$","i");default:return new RegExp(""+l,"i")}},me=function(i){return"object"===E(i)&&!(i instanceof RegExp)},ge=function(i){if(me(i)){var l={};for(var d in i)l[d]=null!=i[d]&&me(i[d])?ge(i[d]):i[d];return l}return i},_e=function(i,l,d){var m=E(i);if(m!==E(l))return!1;switch(m===k.DateTime&&(i=i.getTime(),l=l.getTime()),d){case C.GreaterThan:return i>l;case C.LessThan:return i<l;case C.LessThanEqualTo:return i<=l;case C.GreaterThanEqualTo:return i>=l;case C.NotEqualTo:return i!==l;default:return i===l}},nt=function(){function e(i,l){this.where=ge(i),this.checkFlag=l}return e.prototype.remove=function(i){var l=i.pop();delete i.reduce((function(i,l){return i&&i[l]}),this.where)[l]},e.prototype.check=function(i){var l=!0;if(!this.checkFlag)return l;for(var d in this.where){if(!l)return l;var m=this.where[d],w=i[d];if("object"===E(m))for(var k in m){if(!l)return l;switch(k){case C.In:l=this.checkIn(d,w);break;case C.Like:l=this.checkLike_(d,w);break;case C.Regex:l=this.checkRegex(d,w);break;case C.Between:case C.GreaterThan:case C.LessThan:case C.GreaterThanEqualTo:case C.LessThanEqualTo:case C.NotEqualTo:l=this.checkComparisionOp_(d,w,k);break;default:l=!1}}else l=_e(m,w)}return l},e.prototype.checkIn=function(i,l){return null!=this.where[i][C.In].find((function(i){return _e(i,l)}))},e.prototype.checkLike_=function(i,l){return be(this.where[i][C.Like]).test(l)},e.prototype.checkRegex=function(i,l){return this.where[i][C.Regex].test(l)},e.prototype.checkComparisionOp_=function(i,l,d){var m=this.where[i][d];return d!=C.Between?_e(l,m,d):_e(l,m.low,">=")&&_e(l,m.high,"<=")},e}(),ot=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),it=function(i){function t(){var l=null!==i&&i.apply(this,arguments)||this;return l.shouldEvaluateLimitAtEnd=!1,l.shouldEvaluateSkipAtEnd=!1,l}return ot(t,i),t.prototype.goToWhereLogic=function(){var i=this.query,l=D(i.where);if(!this.objectStore.indexNames.contains(l)){var d=this.getColumnInfo(l),w=new Qe(null==d?m.ColumnNotExist:m.EnableSearchOff,{column:l});return _(w)}var k=i.where[l];if("object"!==E(k))return q=Q(i.where)>1,this.whereCheckerInstance=new nt(i.where,q),this.whereCheckerInstance.remove([l]),this.executeWhereLogic(l,k,null,"next");var q=Q(k)>1||Q(i.where)>1;this.whereCheckerInstance=new nt(i.where,q);var S=D(k);switch(this.whereCheckerInstance.remove([l,S]),S){case C.Like:var O=be(k[C.Like]);return this.executeRegexLogic(l,O);case C.Regex:return this.executeRegexLogic(l,k[C.Regex]);case C.In:return this.executeInLogic(l,k[C.In]);case C.Between:case C.GreaterThan:case C.LessThan:case C.GreaterThanEqualTo:case C.LessThanEqualTo:return this.executeWhereLogic(l,k,S,"next");case C.Aggregate:break;default:return this.executeWhereLogic(l,k,null,"next")}},t}(De),Ee=function(i,l){var d=this,m=this.skipRecord,o=function(i){0===m?d.pushResult(i):--m},w=function(){if(!1===d.shouldEvaluateLimitAtEnd&&!1===d.shouldEvaluateSkipAtEnd){if(d.skipRecord&&d.limitRecord)return Te;if(d.skipRecord)return qe;d.limitRecord}return Se}(),k=this.objectStore.index(i);return g(l.map((function(i){return l=i,p((function(i,m){var q=k.openCursor(d.util.keyRange(l));q.onsuccess=w.call(d,i,o),q.onerror=m}));var l})))},Te=function(i,l){var d=this;return function(m){var w=m.target.result;if(d.results.length!==d.limitRecord&&w){var k=w.value;d.shouldAddValue(k)&&l(k),w.continue()}else i()}},qe=function(i,l){var d=this;return function(m){var w=m.target.result;if(w){var k=w.value;d.shouldAddValue(k)&&l(k),w.continue()}else i()}},Se=function(i){var l=this;return function(d){var m=d.target.result;if(m){var w=m.value;l.shouldAddValue(w)&&l.pushResult(w),m.continue()}else i()}},Ce=function(i,l){var d=this,m=this.skipRecord,o=function(i){0===m?d.pushResult(i):--m};this.shouldAddValue=function(i){return l.test(i.key)&&d.whereCheckerInstance.check(i.value)};var w=this.objectStore.index(i).openCursor(),k=function(){if(!1===d.shouldEvaluateLimitAtEnd&&!1===d.shouldEvaluateSkipAtEnd){if(d.skipRecord&&d.limitRecord)return Oe;if(d.skipRecord)return Ie;if(d.limitRecord)return je}return Ae}();return p((function(i,l){w.onerror=l,w.onsuccess=k.call(d,i,o)}))},Oe=function(i,l){var d=this;return function(m){var w=m.target.result;d.results.length!==d.limitRecord&&w?(d.shouldAddValue(w)&&l(w.value),w.continue()):i()}},Ie=function(i,l){var d=this;return function(m){var w=m.target.result;w?(d.shouldAddValue(w)&&l(w.value),w.continue()):i()}},je=function(i){var l=this;return function(d){var m=d.target.result;l.results.length!==l.limitRecord&&m?(l.shouldAddValue(m)&&l.pushResult(m.value),m.continue()):i()}},Ae=function(i){var l=this;return function(d){var m=d.target.result;m?(l.shouldAddValue(m)&&l.pushResult(m.value),m.continue()):i()}},Ne=function(){return Ne=Object.assign||function(i){for(var l,d=1,m=arguments.length;d<m;d++)for(var w in l=arguments[d])Object.prototype.hasOwnProperty.call(l,w)&&(i[w]=l[w]);return i},Ne.apply(this,arguments)},Re=function(){return new ut(this).execute().then((function(i){}))},ut=function(){function e(i){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=i}return Object.defineProperty(e.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),e.prototype.getTable=function(i){return this.select.table(i)},e.prototype.executeSelect=function(i){return new at(i,this.select.util).execute(this.select.db)},e.prototype.execute=function(){var i=this,l=this.select.query;E(l.join)===k.Object?this.joinQueryStack_=[l.join]:this.joinQueryStack_=l.join;var d=l.from;return this.executeSelect({from:d,where:l.where,case:l.case,flatten:l.flatten}).then((function(l){return i.results=l.map((function(l){var d;return(d={})[i.currentQueryStackIndex_]=l,d})),i.tablesFetched.push(d),i.startExecutingJoinLogic_()}))},e.prototype.onJoinQueryFinished_=function(){var i=this;if(this.query,this.results.length>0)try{var l=[],d=Object.keys(this.results[0]).length,o=function(i,l){if(null!=i.as)for(var d in i.as)void 0===l[i.as[d]]&&(l[i.as[d]]=l[d],delete l[d]);return l};this.results.forEach((function(m){for(var w=m[0],k=1;k<d;k++){var q=i.joinQueryStack_[k-1];w=Ne(Ne({},w),o(q,m[k]))}l.push(w)})),this.select.results=l,this.select.setLimitAndSkipEvaluationAtEnd_(),this.select.query.flatten=null;try{this.select.processOrderBy()}catch(i){return _(new Qe(m.InvalidOrderQuery,i.message))}try{this.select.processGroupDistinctAggr()}catch(i){return _(new Qe(m.InvalidGroupQuery,i.message))}}catch(i){return _(new Qe(m.InvalidJoinQuery,i.message))}},e.prototype.startExecutingJoinLogic_=function(){var i=this,l=this.joinQueryStack_[this.currentQueryStackIndex_];if(!l)return this.onJoinQueryFinished_();try{var d=this.getJoinTableInfo_(l.on);l.with===d.table1.table&&(d={table1:d.table2,table2:d.table1});var w=this.checkJoinQuery_(d,l);return w?_(w):this.executeSelect({from:l.with,where:l.where,case:l.case,flatten:l.flatten}).then((function(m){return i.jointables(l.type,d,m),i.tablesFetched.push(d.table2.table),++i.currentQueryStackIndex_,i.startExecutingJoinLogic_()}))}catch(i){return _(new Qe(m.InvalidJoinQuery,i.message))}},e.prototype.jointables=function(i,l,d){var m,w,k,q,S=this,C=[],O=l.table1.column,I=l.table2.column,j=this.tablesFetched.indexOf(l.table1.table),A=this.currentQueryStackIndex_+1;"left"===i?(k=0,q={},S.getTable(l.table2.table).columns.forEach((function(i){q[i.name]=null})),S.results.forEach((function(i){m=[],w=1===A?function(l){i[j][O]===l[I]&&m.push(l)}:function(l){var d=i[j];null!=d&&d[O]===l[I]&&m.push(l)},d.forEach(w),0===m.length&&(m=[q]),m.forEach((function(l){C[k]=Ne({},i),C[k++][A]=l}))}))):function(){var i=0;S.results.forEach((function(l){d.forEach((function(d){l[j][O]===d[I]&&(C[i]=Ne({},l),C[i++][A]=d)}))}))}(),this.results=C},e.prototype.getJoinTableInfo_=function(i){var l=(i=J(i)).split("="),d=l[0].split("."),m=l[1].split(".");return{table1:{table:d[0],column:d[1]},table2:{table:m[0],column:m[1]}}},e.prototype.checkJoinQuery_=function(i,l){var d,w=i.table1,k=i.table2,q=this.getTable(w.table),S=this.getTable(k.table);return l.with!==k.table&&(d=new Qe(m.InvalidJoinQuery,"on value should contains value of with")),null==q.columns.find((function(i){return i.name===w.column}))?d=new Qe(m.InvalidJoinQuery,"column "+w.column+" does not exist in table "+w.table):null==S.columns.find((function(i){return i.name===k.column}))&&(d=new Qe(m.InvalidJoinQuery,"column "+k.column+" does not exist in table "+k.table)),null==l.as&&(l.as={}),q.columns.every((function(i){var q=S.columns.find((function(l){return l.name===i.name&&l.name!==w.column}));return null==q||null!=l.as[q.name]||(d=new Qe(m.InvalidJoinQuery,"column "+i.name+" exist in both table "+w.table+" & "+k.table),!1)})),d},e}(),st=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),Le=function(){return Le=Object.assign||function(i){for(var l,d=1,m=arguments.length;d<m;d++)for(var w in l=arguments[d])Object.prototype.hasOwnProperty.call(l,w)&&(i[w]=l[w]);return i},Le.apply(this,arguments)},Ve=function(i,l){for(var d=0,m=l.length,w=i.length;d<m;d++,w++)i[w]=l[d];return i},at=function(i){function t(l,d){var m=i.call(this)||this;return m.sorted=!1,m.isSubQuery=!1,m.thenEvaluator=new rt,m.setLimitAndSkipEvaluationAtEnd_=V,m.setPushResult=L,m.removeDuplicates=W,m.executeWhereUndefinedLogic=P,m.executeJoinQuery=Re,m.processGroupDistinctAggr=M,m.processOrderBy=ae,m.processAggregateQry=ce,m.executeAggregateGroupBy=he,m.processGroupBy=le,m.executeInLogic=Ee,m.executeWhereLogic=fe,m.executeRegexLogic=Ce,m.returnResult_=function(){if(m.query.flatten){var i=[],l={};m.query.flatten.forEach((function(d){m.results.forEach((function(m,w){m[d].forEach((function(l){var w;i.push(Le(Le({},m),((w={})[d]=l,w)))})),l[w]=!0}))}));var d=0;N(l).forEach((function(i){m.results.splice(Number(i)-d,1),++d})),m.results=m.results.concat(i)}return m.processGroupDistinctAggr(),m.processOrderBy(),m.shouldEvaluateSkipAtEnd&&m.results.splice(0,m.query.skip),m.shouldEvaluateLimitAtEnd&&(m.results=m.results.slice(0,m.query.limit)),m.results},m.query=l,m.util=d,m.tableName=l.from,m.setPushResult(),R(m.query.where)?(m.isArrayQry=!0,m.setLimitAndSkipEvaluationAtEnd_()):(m.skipRecord=l.skip,m.limitRecord=l.limit),l.order?((R(l.order)||l.order.case||"object"==typeof l.order.by)&&(m.query.order.idbSorting=!1),m.setLimitAndSkipEvaluationAtEnd_()):l.groupBy&&m.setLimitAndSkipEvaluationAtEnd_(),m}return st(t,i),t.prototype.execute=function(i){var l;this.db=i;try{var d=new Ke(i).validate(q.Select,this.query);return d?_(d):(null==this.query.join?null!=this.query.where?(this.initTransaction_(),l=R(this.query.where)?this.processWhereArrayQry():this.processWhere_()):(this.initTransaction_(),l=this.executeWhereUndefinedLogic()):l=this.executeJoinQuery(),l.then(this.returnResult_.bind(this)))}catch(i){return this.onException(i)}},t.prototype.processWhereArrayQry=function(){var i=this;this.isArrayQry=!0;var l,d=this.query.where,m=this.primaryKey(),w=!0,k=[],u=function(){var q;if(l===C.And?!0===w?k=i.results:k.length>0&&(q=[],i.results.forEach((function(i){var l;l=i[m],k.findIndex((function(i){return i[m]===l}))>=0&&q.push(i)})),k=q,q=null):k.length>0?(i.results=Ve(Ve([],k),i.results),i.removeDuplicates(),k=i.results):k=i.results,w=!1,d.length>0)return i.results=[],s();i.results=k},s=function(){return i.query.where=d.shift(),i.query.where[C.Or]&&1===Q(i.query.where)?(l=C.Or,i.query.where=i.query.where[C.Or]):l=C.And,i.processWhere_().then(u)};return s()},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.tableName],O.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var i=this;return this.shouldAddValue=function(l){return i.whereCheckerInstance.check(l)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then((function(){return i.onWhereEvaluated()}))},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=Ve(Ve([],this.orInfo.results),this.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var i=D(this.orInfo.orQuery);if(null!=i){var l={};return l[i]=this.orInfo.orQuery[i],delete this.orInfo.orQuery[i],this.query.where=l,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var i=this.query.where;this.orInfo={orQuery:i.or,results:[]},delete i.or},t}(it),Be=function(){var i,l,d=this,m=d.objectStore.count?(i=d.objectStore.count(),function(l){return function(){d.resultCount=i.result,l()}}):(i=d.objectStore.openCursor(),function(i){return function(m){(l=m.target.result)?(++d.resultCount,l.continue()):i()}});return p((function(l,d){i.onerror=d,i.onsuccess=m(l)}))},Pe=function(i,l,d){var m,w,k=this;return l=d?l[d]:l,p((function(q,S){1===Q(k.query.where)&&k.objectStore.count?(m=k.objectStore.index(i).count(k.util.keyRange(l,d))).onsuccess=function(){k.resultCount=m.result,q()}:(m=k.objectStore.index(i).openCursor(k.util.keyRange(l,d))).onsuccess=function(i){(w=i.target.result)?(k.whereCheckerInstance.check(w.value)&&++k.resultCount,w.continue()):q()},m.onerror=S}))},Ue=function(i,l){var d,m=this,w=this.objectStore.index(i).openCursor();return this.shouldAddValue=function(i){return l.test(i.key)&&m.whereCheckerInstance.check(i.value)},p((function(i,l){w.onerror=l,w.onsuccess=function(l){(d=l.target.result)?(m.shouldAddValue(d)&&++m.resultCount,d.continue()):i()}}))},Ge=function(i,l){var d,m=this,w=this.objectStore.index(i);return g(l.map((function(i){return l=i,k=m.util.keyRange(l),m.objectStore.count?p((function(i,l){var d=w.count(k);d.onsuccess=function(l){m.resultCount+=l.target.result,i()},d.onerror=l})):p((function(i,l){var q=w.openCursor(k);q.onsuccess=function(l){(d=l.target.result)?(m.whereCheckerInstance.check(d.value)&&++m.resultCount,d.continue()):i()},q.onerror=l}));var l,k})))},ct=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),lt=function(i){function t(l,d){var m=i.call(this)||this;return m.resultCount=0,m.executeWhereUndefinedLogic=Be,m.executeWhereLogic=Pe,m.executeRegexLogic=Ue,m.executeInLogic=Ge,m.query=l,m.util=d,m.tableName=l.from,m}return ct(t,i),t.prototype.execute=function(i){var l=this;this.db=i;var d=new Ke(i),m=this.query,w=d.validate(q.Count,m);if(w)return _(w);try{var k=void 0,s=function(){var d=new at(l.query,l.util);return d.isTxQuery=l.isTxQuery,d.execute(i).then((function(i){l.resultCount=i.length}))};return null==m.join?null!=m.where?m.where.or||R(this.query.where)?k=s():(this.initTransaction_(),k=this.goToWhereLogic()):(this.initTransaction_(),k=this.executeWhereUndefinedLogic()):k=s(),k.then((function(){return l.resultCount}))}catch(i){this.onException(i)}},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from],O.ReadOnly),this.objectStore=this.util.objectStore(this.query.from)},t}(it),Je=function(i,l){for(var d in i)if(E(i[d])!==k.Object)l[d]=i[d];else for(var m in i[d]){switch(m){case"+":l[d]+=i[d][m];break;case"-":l[d]-=i[d][m];break;case"*":l[d]*=i[d][m];break;case"/":l[d]/=i[d][m];break;case"{push}":l[d].push(i[d][m]);break;default:l[d]=i[d]}break}return l},Me=function(){var i=this,l=this.objectStore.openCursor(),d=this.query.set;return p((function(m,w){l.onsuccess=function(l){var k=l.target.result;if(k)try{var q=k.update(Je(d,k.value));q.onsuccess=function(){++i.rowAffected,k.continue()},q.onerror=w}catch(i){w(i)}else m()},l.onerror=w}))},ze=function(i,l){var d=this,m=this.objectStore.index(i),w=this.query;return g(l.map((function(i){return l=i,p((function(i,k){var q=m.openCursor(d.util.keyRange(l));q.onsuccess=function(l){var m=l.target.result;if(m){var q=m.value;if(d.whereCheckerInstance.check(q))try{var S=m.update(Je(w.set,q));S.onsuccess=function(){++d.rowAffected,m.continue()},S.onerror=k}catch(i){k(i)}else m.continue()}else i()},q.onerror=k}));var l})))},$e=function(i,l){var d,m=this,w=this.objectStore.index(i).openCursor();this.shouldAddValue=function(i){return l.test(i.key)&&m.whereCheckerInstance.check(i.value)};var k=this.query.set;return p((function(i,l){w.onsuccess=function(w){if(d=w.target.result)if(m.shouldAddValue(d))try{var q=d.update(Je(k,d.value));q.onsuccess=function(){++m.rowAffected,d.continue()},q.onerror=l}catch(i){l(i)}else d.continue();else i()},w.onerror=l}))},He=function(i,l,d){var m=this;l=d?l[d]:l;var w=this.objectStore.index(i).openCursor(this.util.keyRange(l,d)),k=this.query.set;return p((function(i,l){w.onsuccess=function(d){var w=d.target.result;if(w)if(m.whereCheckerInstance.check(w.value))try{var q=w.update(Je(k,w.value));q.onsuccess=function(){++m.rowAffected,w.continue()},q.onerror=l}catch(i){l(i)}else w.continue();else i()},w.onerror=l}))},ht=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),ft=function(i){function t(l,d){var m=i.call(this)||this;return m.executeWhereUndefinedLogic=Me,m.executeInLogic=ze,m.executeRegexLogic=$e,m.executeWhereLogic=He,m.query=l,m.util=d,m.tableName=l.in,m}return ht(t,i),t.prototype.execute=function(i){var l=this;this.db=i;var d=this.query;try{var m=new Ke(i).validate(q.Update,d);return m?_(m):(this.initTransaction(),(null!=d.where?d.where.or||R(d.where)?this.executeComplexLogic_():this.goToWhereLogic():this.executeWhereUndefinedLogic()).then((function(){return l.rowAffected})))}catch(i){return this.onException(i)}},t.prototype.executeComplexLogic_=function(){var i=this,l=this.query,d=new at({from:l.in,where:l.where,ignoreCase:l.ignoreCase},this.util);return d.isTxQuery=this.isTxQuery,d.execute(this.db).then((function(d){var m,w,k=i.primaryKey(l.in),q=[];d.forEach((function(i){q.push(i[k])})),d=null;var S=((m={})[k]=((w={})[C.In]=q,w),m);return i.query.where=S,i.initTransaction(),i.goToWhereLogic()}))},t.prototype.initTransaction=function(){var i=this.query.in;this.isTxQuery||this.util.createTransaction([i]),this.objectStore=this.util.objectStore(i)},t}(it),pt=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),et=function(){return et=Object.assign||function(i){for(var l,d=1,m=arguments.length;d<m;d++)for(var w in l=arguments[d])Object.prototype.hasOwnProperty.call(l,w)&&(i[w]=l[w]);return i},et.apply(this,arguments)},dt=function(i){function t(l,d){var m=i.call(this)||this;return m.query=l,m.util=d,m}return pt(t,i),t.prototype.execute=function(i){var l=this;this.db=i;var d,m,w=this.query,k=0,q={},S={},C=!0,O=w.queries,I=O.length;if(O.every((function(i,l){return!(l+1<I&&i.from!==O[l+1].from&&(C=!1,1))})),C){var j=this.primaryKey(O[0].from);d=function(i){return i[j]}}else d=function(i){var l="";for(var d in i)l+=i[d];return l};var f=function(){if(k<I)return(m=new at(O[k],l.util)).execute(l.db).then((function(i){return q={},i.forEach((function(i){var l=d(i);0===k?S[l]=i:null!=S[l]&&(q[l]=i)})),k>0&&(S=et({},q)),++k,f()}));var i=[],C=void 0,j=w.skip,A=w.limit,B=!1,y=function(){i.push(q[we])},v=function(){i.length<A?y():B=!0},b=function(i){0===j?i():--j};if(C=w.skip&&w.limit?function(){b((function(){v()}))}:w.limit?v:w.skip?function(){b((function(){y()}))}:function(){y()},A){for(var we in q)if(C(we),B)break}else for(we in q)C(we);return m.results=i,Object.assign(m.query,{order:w.order,join:{}}),m.processOrderBy(),m.processGroupDistinctAggr(),m.results};return f()},t}(De),yt=function(){function e(){}return e.prototype.execute=function(i){return p((function(l,d){var w=indexedDB.deleteDatabase(i);w.onblocked=function(){var i=new Qe(m.DbBlocked);return d(x(i))},w.onerror=function(i){return d(x(i))},w.onsuccess=function(){l()}}))},e}(),vt=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),bt=function(i){function t(l,d){var m=i.call(this)||this;return m.query=l,m.util=d,m}return vt(t,i),t.prototype.execute=function(i){var l=this;this.db=i;var d,m=this.query,w=0,k={},q=!0,S=m.length;if(m.every((function(i,l){return!(l+1<S&&i.from!==m[l+1].from&&(q=!1,1))})),q){var C=this.primaryKey(m[0].from);d=function(i){return i[C]}}else d=function(i){var l="";for(var d in i)l+=i[d];return l};var c=function(){if(w<m.length)return new at(m[w++],l.util).execute(i).then((function(i){return i.forEach((function(i){k[d(i)]=i})),c()}));var q=[];for(var S in k)q.push(k[S]);return q};return c()},t}(De),mt=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),gt=function(i){function t(l,d){var m=i.call(this)||this;return m.query=l,m.util=d,m.tableName=l.from,m}return mt(t,i),t.prototype.execute=function(i){var l=this;this.db=i;var d=new Ke(i),m=this.query,w=d.validate(q.Remove,m);if(w)return _(w);try{return this.initTransaction_(),(null!=m.where?R(m.where)?this.processWhereArrayQry():this.processWhere_():this.executeWhereUndefinedLogic()).then((function(){return l.rowAffected}))}catch(i){return this.onException(i)}},t.prototype.processWhereArrayQry=function(){var i=this,l=new at(this.query,this.util);return l.isTxQuery=this.isTxQuery,l.execute(this.db).then((function(l){var d,m,w=[],k=i.primaryKey(i.query.from);l.forEach((function(i){w.push(i[k])})),l=null;var q=((d={})[k]=((m={})[C.In]=w,m),d);return i.query[C.Where]=q,i.processWhere_()}))},t.prototype.processWhere_=function(){var i=this;return this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then((function(){return i.onWhereEvaluated()}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var i=this,l=D(this._orInfo.OrQuery);if(null!=l){var d={};return d[l]=this._orInfo.OrQuery[l],delete this._orInfo.OrQuery[l],this.query.where=d,this.goToWhereLogic().then((function(){return i.onWhereEvaluated()}))}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var i=this.query.where;this._orInfo={OrQuery:i.or},delete i.or},t}(it);gt.prototype.executeInLogic=function(i,l){var d=this;return g(l.map((function(l){return m=l,p((function(l,w){var k=d.objectStore.index(i).openCursor(d.util.keyRange(m));k.onsuccess=function(i){var m=i.target.result;m?(d.whereCheckerInstance.check(m.value)&&(m.delete(),++d.rowAffected),m.continue()):l()},k.onerror=w}));var m})))},gt.prototype.executeWhereUndefinedLogic=function(){var i,l=this,d=this.objectStore.openCursor();return p((function(m,w){d.onsuccess=function(d){(i=d.target.result)?(i.delete(),++l.rowAffected,i.continue()):m()},d.onerror=w}))},gt.prototype.executeWhereLogic=function(i,l,d){var m,w,k=this;return l=d?l[d]:l,w=this.objectStore.index(i).openCursor(this.util.keyRange(l,d)),p((function(i,l){w.onsuccess=function(l){(m=l.target.result)?(k.whereCheckerInstance.check(m.value)&&(m.delete(),++k.rowAffected),m.continue()):i()},w.onerror=l}))},gt.prototype.executeRegexLogic=function(i,l){var d,m=this,w=this.objectStore.index(i).openCursor();return this.shouldAddValue=function(i){return l.test(i.key)&&m.whereCheckerInstance.check(i.value)},p((function(i,l){w.onsuccess=function(l){(d=l.target.result)?(m.shouldAddValue(d)&&(d.delete(),++m.rowAffected),d.continue()):i()},w.onerror=l}))};var _t=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),wt=function(i){function t(l,d){var m=i.call(this)||this;return m.query=l,m.util=d,m.tableName=l,m}return _t(t,i),t.prototype.execute=function(i){var l=this;this.db=i;var d=this.query;this.isTxQuery||this.util.createTransaction([d,xe.tableName]);var m=this.util.objectStore(d).clear();try{return p((function(w,k){m.onsuccess=function(){var m=l.table(d);for(var q in m.autoIncColumnValue)m.autoIncColumnValue[q]=0;xe.set(xe.dbSchema,i,l.util).then((function(){w()})).catch(k)},m.onerror=k}))}catch(i){return this.onException(i)}},t}(De),xt=function(){var e=function(i,l){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,l){i.__proto__=l}||function(i,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(i[d]=l[d])},e(i,l)};return function(i,l){if("function"!=typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function r(){this.constructor=i}e(i,l),i.prototype=null===l?Object.create(l):(r.prototype=l.prototype,new r)}}(),kt=function(i){function t(l,d){var m=i.call(this)||this;return m.results={},m.reqQueue=[],m.isQueryExecuting=!1,m.isTxStarted_=!1,m.query=l,m.util=d,m}return xt(t,i),t.prototype.execute=function(i){var l=this;this.db=i;var d=this.validate();return d?_(d):(this.startExecution_(),p((function(i,d){l.onSuccess=i,l.onError=d})).then((function(i){return console.log("transaction finished"),i})))},t.prototype.validate=function(){var i=this.query,l=this.notExistingTable_(i.tables);if(l)return new Qe(m.TableNotExist,{tableName:l});var d=i.method;return self[d]?void 0:new Qe(m.MethodNotExist,d)},t.prototype.startExecution_=function(){var i=this,l=this.query,d=l.method,m=self[d];return console.log("transaction query started"),m.call(this,{data:l.data,insert:function(l){return i.pushReq_({name:q.Insert,query:l})},select:function(l){return i.pushReq_({name:q.Select,query:l})},update:function(l){return i.pushReq_({name:q.Update,query:l})},remove:function(l){return i.pushReq_({name:q.Remove,query:l})},count:function(l){return i.pushReq_({name:q.Count,query:l})},setResult:function(l,d){i.results[l]=d},getResult:function(l){return i.results[l]},abort:function(l){i.abortTx_(l)},start:function(){i.startTx_()}})},t.prototype.startTx_=function(){var i=this;try{this.isTxStarted_=!0;var l=this.query.tables;return l=l.concat(xe.tableName),this.util.createTransaction(l).then((function(){i.onSuccess(i.results)})).catch((function(l){i.onError(l)})),this.processExecutionOfQry_()}catch(i){this.onError(this.onException(i))}},t.prototype.onReqFinished_=function(i){var l=this.reqQueue.shift();console.log("finished request : "+l.name+" "),l&&(i.error?(this.abortTx_("automatic abort of transaction due to error occured"),console.log("transaction aborted due to error occured"),this.onError(i.error)):(this.isQueryExecuting=!1,l.onSuccess&&l.onSuccess(i),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(i){this.reqQueue=[],this.util.abortTransaction(),console.log("transaction aborted. Msg : "+i)},t.prototype.executeRequest_=function(i){var l;this.isQueryExecuting=!0,console.log("executing request : "+i.name+" ");var d=this.onReqFinished_.bind(this),m=i.query;switch(i.name){case q.Select:l=new at(m,this.util);break;case q.Insert:l=new Ye(m,this.util);break;case q.Update:l=new ft(m,this.util);break;case q.Remove:l=new gt(m,this.util);break;case q.Count:l=new lt(m,this.util)}l.isTxQuery=!0,l.execute(this.db).then(d).catch((function(i){d({error:i})}))},t.prototype.pushReq_=function(i){var l=this,n=function(){l.reqQueue.push(i)},d=p((function(l,d){i.onSuccess=function(i){l(i)},i.onError=function(i){d(i)}}));return!0===this.isTxStarted_?(n(),this.processExecutionOfQry_()):n(),console.log("request pushed : "+i.name+" with query value - "+JSON.stringify(i.query)),d},t.prototype.processExecutionOfQry_=function(){!1===this.isQueryExecuting&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(i){var l=this,d=null;return i.every((function(i){return null!=l.table(i)||(d=i,!1)})),d},t}(De),Et=function(){function e(i){this.onQryFinished=Ze?function(i){self.postMessage(i)}:i}return e.prototype.run=function(i){var l,d=this;switch(i.name){case q.OpenDb:l=this.openDb(i.query);break;case q.InitDb:l=this.initDb(i.query);break;case q.CloseDb:l=this.closeDb();break;case q.Insert:l=this.insert(i.query);break;case q.Select:l=this.select(i.query);break;case q.Count:l=this.count(i.query);break;case q.Update:l=new ft(i.query,this.util).execute(this.db);break;case q.Intersect:l=new dt(i.query,this.util).execute(this.db);break;case q.DropDb:l=this.dropDb();break;case q.Terminate:l=this.terminate();break;case q.Union:l=new bt(i.query,this.util).execute(this.db);break;case q.Remove:l=new gt(i.query,this.util).execute(this.db);break;case q.Clear:l=new wt(i.query,this.util).execute(this.db);break;case q.Transaction:l=new kt(i.query,this.util).execute(this.db);break;case q.Get:l=xe.get(i.query,this.util);break;case q.Set:var w=i.query;l=xe.set(w.key,w.value,this.util);break;case q.ImportScripts:l=p((function(l,d){try{importScripts.apply(void 0,i.query),l()}catch(i){d(new Qe(m.ImportScriptsFailed,i.message))}}));break;default:console.error("The Api:-"+i.name+" does not support."),l=Promise.resolve()}l.then((function(i){d.returnResult_({result:i})})).catch((function(i){var l=x(i);d.returnResult_({error:l})}))},e.prototype.returnResult_=function(i){this.util&&this.util.emptyTx(),this.onQryFinished(i)},e.prototype.dropDb=function(){var i=this.db.name;return this.terminate().then((function(){return(new yt).execute(i)}))},e.prototype.closeDb=function(){return null==this.util?Promise.resolve():this.util.close()},e.prototype.terminate=function(){var i=this;return this.closeDb().then((function(){i.db=i.util=null}))},e.prototype.openDb=function(i){var l=this;return(this.db&&i.name===this.db.name?this.initDb():this.initDb({name:i.name,tables:[],version:i.version})).then((function(){return l.db}))},e.prototype.initDb=function(i){var l=this;if(!tt)return _(new Qe(m.IndexedDbNotSupported));var d=i?new b(i):this.db;return this.util=new ke(d),p((function(i,m){l.util.initDb().then((function(i){return i||(m=i,p((function(i,w){xe.get(xe.dbSchema,l.util).then((function(k){var q,S=!1;if(k&&(q=k.version,k.tables.forEach((function(i,l){var m=d.tables[l];m&&(i.version<m.version?(m.state=A.Delete,S=!0,q<m.version&&(q=m.version)):m.state=null)}))),S)return d.version=q,void l.terminate().then((function(){l.util=new ke(d),l.util.initDb().then((function(l){i(l)})).catch(w)}));m||(l.db=k),i(m)}))})));var m})).then((function(m){m?xe.set(xe.dbSchema,d,l.util).then((function(){l.db=d,i(!0)})):i(!1)})).catch(m)}))},e.prototype.insert=function(i){return new Ye(i,this.util).execute(this.db)},e.prototype.select=function(i){return new at(i,this.util).execute(this.db)},e.prototype.count=function(i){return new lt(i,this.util).execute(this.db)},e}();if(Ze){var Tt=new Et;self.onmessage=function(i){Tt.run(i.data)}}}});';
    const JsStore = function(n){var r={};function o(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}return o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([,function(e,t,n){"use strict";n.r(t),n.d(t,"Connection",function(){return h}),n.d(t,"DATA_TYPE",function(){return r});u.prototype.throw=function(){throw this.get()},u.prototype.log=function(e){this.status&&console.log(e)},u.prototype.logError=function(){console.error(this.get())},u.prototype.logWarning=function(){console.warn(this.get())},u.prototype.get=function(){return{message:this.message,type:this.type}},u.prototype.getMsg=function(){return this.type,this.message};var r,o,i,s=u;function u(e,t){this.type=e,this._info=t,this.message=this.getMsg()}(n=r=r||{}).String="string",n.Object="object",n.Array="array",n.Number="number",n.Boolean="boolean",n.Null="null",n.DateTime="date_time",(t=o=o||{}).InitDb="init_db",t.Get="get",t.Set="set",t.Select="select",t.Insert="insert",t.Update="update",t.Remove="remove",t.OpenDb="open_db",t.Clear="clear",t.DropDb="drop_db",t.Count="count",t.ChangeLogStatus="change_log_status",t.Terminate="terminate",t.Transaction="transaction",t.CloseDb="close_db",t.Union="union",t.Intersect="intersect",t.ImportScripts="import_scripts",(n=i=i||{}).RequestQueueEmpty="requestQueueEmpty",n.RequestQueueFilled="requestQueueFilled";Object.defineProperty(p.prototype,"jsstoreWorker",{get:function(){return this.$worker||window.JsStoreWorker},enumerable:!1,configurable:!0}),p.prototype.initQueryManager_=function(){var e=this.jsstoreWorker;e&&(this.queryManager=new e.QueryManager(this.processFinishedQuery_.bind(this)))},p.prototype.onMessageFromWorker_=function(e){this.processFinishedQuery_(e.data)},p.prototype.processFinishedQuery_=function(e){var t=this.requestQueue_.shift();if(t){if(this.logger.log("request "+t.name+" finished"),e.error)t.onError(e.error);else{switch(t.name){case o.OpenDb:case o.InitDb:this.isConOpened_=!0;break;case o.Terminate:!(this.isConOpened_=!1)===this.isRuningInWorker&&this.worker_.terminate();case o.DropDb:this.isConOpened_=!1,this.requestQueue_=[],this.isDbIdle_=!0;break;case o.CloseDb:0<this.requestQueue_.length?this.openDb_():(this.isDbIdle_=!0,this.callEvent(i.RequestQueueEmpty,[]))}t.onSuccess(e.result)}this.isCodeExecuting_=!1,this.executeQry_()}},p.prototype.openDb_=function(){this.prcoessExecutionOfQry_({name:o.OpenDb,query:{name:this.database.name,version:this.database.version},onSuccess:function(){},onError:function(e){console.error(e)}},0)},p.prototype.executeMiddleware_=function(o){var i=this;return new Promise(function(e){function t(){n<=r?i.middlewares[n++](o,t):e()}var n=0,r=i.middlewares.length-1;t()})},p.prototype.pushApi=function(n){var r=this;return new Promise(function(e,t){r.executeMiddleware_(n).then(function(){n.onSuccess=e,n.onError=t,0===r.requestQueue_.length&&(r.callEvent(i.RequestQueueFilled,[]),!(0<=[o.CloseDb,o.DropDb,o.OpenDb,o.Terminate].indexOf(n.name))&&r.isDbIdle_&&r.isConOpened_?r.openDb_():clearTimeout(r.inactivityTimer_)),r.prcoessExecutionOfQry_(n)}).catch(t)})},p.prototype.prcoessExecutionOfQry_=function(e,t){this.isDbIdle_=!1,null!=t?this.requestQueue_.splice(t,0,e):this.requestQueue_.push(e),this.logger.log("request pushed: "+e.name),this.executeQry_()},p.prototype.executeQry_=function(){var e,t=this,n=this.requestQueue_.length;!this.isCodeExecuting_&&0<n?!0===this.isConOpened_?this.sendRequestToWorker_(this.requestQueue_[0]):0<=(e=this.requestQueue_.findIndex(function(e){return 0<=t.whiteListApi_.indexOf(e.name)}))&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(e,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0])):0===n&&!1===this.isDbIdle_&&this.isConOpened_&&(this.inactivityTimer_=setTimeout(function(){t.prcoessExecutionOfQry_({name:o.CloseDb,onSuccess:function(){},onError:function(e){console.error(e)}})},100))},p.prototype.sendRequestToWorker_=function(e){this.isCodeExecuting_=!0,this.logger.log("request executing: "+e.name);e={name:e.name,query:e.query};!0===this.isRuningInWorker?this.worker_.postMessage(e):this.queryManager.run(e)},p.prototype.callEvent=function(t,n){this.eventQueue.filter(function(e){if(e.event===t)return e}).forEach(function(e){e.callback.apply(e,n)})};t=p;function p(e){this.isConOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.eventQueue=[],this.middlewares=[],this.whiteListApi_=[o.InitDb,o.OpenDb,o.Get,o.Set,o.ChangeLogStatus,o.Terminate,o.DropDb],this.isRuningInWorker=!0,this.logger=new s(null),e?(this.worker_=e,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):(this.isRuningInWorker=!1,this.initQueryManager_())}c=function(e,t){return(c=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(l,a=t),l.prototype.initDb=function(e){return this.database=e,this.pushApi({name:o.InitDb,query:e})},l.prototype.dropDb=function(){return this.pushApi({name:o.DropDb})},l.prototype.select=function(e){return this.pushApi({name:o.Select,query:e})},l.prototype.count=function(e){return this.pushApi({name:o.Count,query:e})},l.prototype.insert=function(e){return this.pushApi({name:o.Insert,query:e})},l.prototype.update=function(e){return this.pushApi({name:o.Update,query:e})},l.prototype.remove=function(e){return this.pushApi({name:o.Remove,query:e})},l.prototype.clear=function(e){return this.pushApi({name:o.Clear,query:e})},Object.defineProperty(l.prototype,"logStatus",{set:function(e){this.logger.status=e,this.pushApi({name:o.ChangeLogStatus,query:e})},enumerable:!1,configurable:!0}),l.prototype.openDb=function(e,t){var n=this;return this.pushApi({name:o.OpenDb,query:{version:t,name:e}}).then(function(e){return n.database=e})},l.prototype.getDbList=function(){return console.warn("Api getDbList is recommended to use for debugging only. Do not use in code."),indexedDB.databases()},l.prototype.get=function(e){return this.pushApi({name:o.Get,query:e})},l.prototype.set=function(e,t){return this.pushApi({name:o.Set,query:{key:e,value:t}})},l.prototype.terminate=function(){return this.pushApi({name:o.Terminate})},l.prototype.transaction=function(e){return this.pushApi({name:o.Transaction,query:e})},l.prototype.on=function(e,t){this.eventQueue.push({event:e,callback:t})},l.prototype.off=function(n,e){var r,t=this;e?(e=this.eventQueue.findIndex(function(e){return e.event===n}),this.eventQueue.splice(e,0)):(r=[],this.eventQueue.forEach(function(e,t){e.event===n&&r.push(t)}),r.forEach(function(e){t.eventQueue.splice(e,1)}))},l.prototype.union=function(e){return this.pushApi({name:o.Union,query:e})},l.prototype.intersect=function(e){return this.pushApi({name:o.Intersect,query:e})},l.prototype.addPlugin=function(e,t){e.setup(this,t)},l.prototype.addMiddleware=function(e){this.middlewares.push(e)},l.prototype.importScripts=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.pushApi({name:o.ImportScripts,query:e})};var c,a,h=l;function l(e){return a.call(this,e)||this}}]);
    const dbName = "Project-db";
    const defaultTable = {
        name: "Projects",
        columns: {
            id: { primaryKey: true, autoIncrement: true },
            name: { dataType: "string" },
            html: { dataType: "string" },
            js: { dataType: "string" },
            ts: { dataType: "string" },
            css: { dataType: "string" },
            assets: { dataType: "string" },
            images: { dataType: "string" },
            created: { dataType: "number" },
            lastEdit: { dataType: "number" }
        }
    };

    const each = (items, cb) => {
        items.constructor === Object ?
            Object.entries(items).forEach(([key, value], index) => cb(key, value, index)) :
            [...items].forEach((key, index) => cb(key, index));
    };

    let db, Projects = [], temp;

    const connect = (useDatabase) => {
        if (useDatabase) {
            return new Promise(resolve => {
                const table = defaultTable;
                db = new JsStore.Connection(new Worker(URL.createObjectURL(new Blob([worker]))));
                db.initDb({ name: dbName, tables: [table], version: 1 });
                db.select({ from: table.name }).then(resolve);
            });
        } else {
            db = {
                index: 0,
                db: { Projects: [] },
                select: function({ where }) {
                    return new Promise(resolve => {
                        if (where) {
                            let key = Object.keys(where)[0];
                            let value = where[key];
                            each(db.db.Projects, data => {
                                data[key] === value && resolve([data]);
                            });
                            resolve([null]);
                        } else resolve(db.db.Projects);
                    });
                },

                update: function(obj) {
                    return new Promise(resolve => {
                        let { set, where } = obj;
                        let key = Object.keys(where)[0];
                        let value = where[key];
                        each(db.db.Projects, (data, i) => {
                            data[key] === value && (each(set, (key, value) => (db.db.Projects[i][key] = value)), resolve());
                        });
                    });
                },

                insert: function({ values }) {
                    return new Promise(resolve => {
                        let data = values[0];
                        data.id = ++db.index;
                        db.db.Projects.push(data);
                        resolve([{ id: data.id }]);
                    });
                },
                remove: function({ where }) {
                    return new Promise(resolve => {
                        let key = Object.keys(where)[0];
                        let value = where[key];
                        each(db.db.Projects, (data, i) => {
                            data[key] === value && (db.db.Projects.splice(i, 1), resolve([true]));
                        });
                        resolve([null]);
                    });
                }
            };
            return new Promise(resolve => resolve([]));
        }
    };

    self.addEventListener("message", function ({ data }) {
        let { action, query, index } = data;
        ["select", "update", "insert", "remove"].includes(action) && !db ? postMessage({ err: "You are currently not connected to any database.\nPlease connect first." }) :
        action === "connect" ? connect(query).then(result => postMessage({ result, index })) : db[action](query).then(result => postMessage({ result, index }));
    });
